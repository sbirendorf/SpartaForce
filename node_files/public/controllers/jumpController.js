function contStartJumpTest(){globals.stopChart=!1,globals.t=0,startJump(),ui.displayMsg("Jumps Remaining :"+globals.jumpTestNubmer),startScanRealTimeChart(),$$("#sway").hide(),$$("#scan").show(),ui.BtnsEnableControll(["scan","stop"])}function validateJumpResult(e){if(e.Countermovement.JumpHeight<globals.ValidationMinJumpHeight||e.JumpHeight>globals.ValidationMaxJumpHeight)return ui.setMsg("Invalid jump height. Jump as to be greater than "+e.JumpHeight,!0),!0;if(e.Countermovement.AverageConcentricPhaseForce<globals.ValidationMinAverageConcentricPhaseForce)return ui.setMsg("Invalid jump (Average Concentric Phase Force)",!0),!0;if(e.Countermovement.AverageEccentricRateOfChange<globals.ValidationMinAverageEccentricRateOfChange)return ui.setMsg("Invalid jump (Average Eccentric Rate Of Change)",!0),!0;if(e.Countermovement.ConcentricVerticalImpulse<globals.ValidationMinConcentricVerticalImpulse)return ui.setMsg("Invalid jump (Concentric Vertical Impulse)",!0),!0;var t=Number(globals.jumpTestNubmer)+1,a=localStorage["Sparta_scan_"+t+"_"+globals.testGUID];return(null!=a||void 0!=a)&&(a=jQuery.parseJSON(a),Math.abs(a.WeightKG-e.WeightKG)>globals.WeightDiff)?(ui.setMsg("Invalid weight, initial weight was "+a.WeightKG+", current weight "+e.WeightKG,!0),!0):!1}function countermovementResult(e){globals.stopChart=!0,e.WeightKG=ui.convertWeight(e.WeightKG);var t=validateJumpResult(e);if(t){ui.displayMsgRight("");var a=new Audio("../error.mp3");a.play(),setTimeout(function(){contStartJumpTest()},3500)}else ui.displayMsgRight('<div class="jump-height"><div class="jump-title">Jump Height </div><div class="jump-number">'+Number(100*e.Countermovement.JumpHeight).toFixed()+"</div></div>",!1),getJumpImage(e,globals.jumpTestNubmer)}function saveJumpToLocalStorage(e,t){d=new Date,e.Date=d.yyyymmdd(),e.imageUrl=t;var e=JSON.stringify(e);localStorage.setItem("Sparta_scan_"+globals.jumpTestNubmer+"_"+globals.testGUID,e);jQuery.parseJSON(localStorage["Sparta_scan_"+globals.jumpTestNubmer+"_"+globals.testGUID]);globals.jumpTestNubmer--,continueScan()}function continueScan(){if(globals.jumpTestNubmer>0)setTimeout(function(){drawData=!0,contStartJumpTest(),ui.displayMsg("Jumps Remaining :"+globals.jumpTestNubmer)},3500);else{ui.displayMsg("Jumps Remaining :"+globals.jumpTestNubmer);var e=confirm("Test Over! Send data to sparta Trac?");1==e&&sendDataToTrac("scan"),globals.jumpTestNubmer=globals.initJumpTestNubmer,ui.displayMsg("")}}function jumpProgress(e){if("waitingforstill"==e.Status&&($$(".log-msg").empty(),ui.displayMsgRight("Stand Still ,Time Remaining "+e.TimeRemainSec.toFixed(0),!1)),"protocolstart"==e.Status){$$(".log-msg").empty(),ui.displayMsgRight("JUMP ",!1);var t=new Audio("../horn.mp3");t.play()}"protocolinprogress"==e.Status&&($$(".log-msg").empty(),ui.displayMsgRight("Jump",!1)),"computingstart"==e.Status&&($$(".log-msg").empty(),ui.displayMsgRight("Done, Computing",!1))}function getJumpImage(e){var t='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';$$("svg").css("background-color","#ffffff");var a=(new XMLSerializer).serializeToString(d3.select("svg").node()),i=new Blob([t+a],{type:"image/svg+xml;charset=utf-8"}),s=window.URL.createObjectURL(i),n=d3.select("body").append("img").attr("width",100).attr("height",100).node(),o="";n.onload=function(){var t=d3.select("body").append("canvas").node();t.width=600,t.height=600;var a=t.getContext("2d");a.drawImage(n,0,0);var i=t.toDataURL("image/png"),s=d3.select("body").append("img").attr("width",150).attr("height",150).node();o=s.src=i,saveJumpToLocalStorage(e,o),$$("canvas").remove(),$$("body img:not(.main-logo)").remove()},n.src=s}